<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <template id="report_ektp_template" name="e-KTP Template">
    <t t-call="web.html_container">

      <style type="text/css"><![CDATA[
        @page { size: 160mm 100mm; margin: 0; }

        html, body {
          width: 160mm !important;
          height: 100mm !important;
          margin: 0 !important;
          padding: 0 !important;
          font-family: Arial, sans-serif;
          color: #000;
        }

        /* Jangan ikut style A4 bawaan report */
        .page {
          width: 160mm !important;
          height: 100mm !important;
          min-height: 100mm !important;
          margin: 0 !important;
          padding: 0 !important;
          overflow: hidden !important;
        }

        .ektp-page {
          position: relative;
          width: 160mm;
          height: 100mm;
        }

        /* CARD: dipusatkan, aman dari kepotong, DAN diberi border */
        .ktp-card {
          width: 146mm;
          height: 86mm;
          margin: 7mm auto 0 auto;

          padding: 4mm 4.5mm;
          box-sizing: border-box;
          background: #fff;

          /* Border kartu (sesuai permintaan) */
          border: 0.7mm solid #1f2d3d;
          border-radius: 5mm;
        }

        /* Hilangkan semua border table bawaan (biar tidak muncul grid) */
        .ktp-card table,
        .ktp-card tr,
        .ktp-card td,
        .ktp-card th {
          border: none !important;
          outline: none !important;
        }
        .ktp-card table {
          border-collapse: collapse !important;
          border-spacing: 0 !important;
        }

        /* HEADER */
        .ktp-header {
          text-align: center;
          margin-top: 0.5mm;
        }
        .ktp-title-1,
        .ktp-title-2 {
          font-weight: 700;
          font-size: 11px;   /* sedikit dibesarkan biar enak */
          line-height: 1.05;
        }

        /* BODY */
        .ktp-body-table {
          width: 100%;
          table-layout: fixed;
          margin-top: 2mm;
        }

        .ktp-left {
          vertical-align: top;
          padding-right: 2.5mm;
        }

        .ktp-right {
          width: 36mm;
          vertical-align: top;
          text-align: center;
        }

        /* Teks Kabupaten disejajarkan dengan foto (di kolom kanan atas) */
        .ktp-region-right {
          font-size: 9px;      /* dibesarkan */
          font-weight: 700;
          line-height: 1.05;
          text-transform: capitalize;
          margin-bottom: 1.5mm;
          white-space: normal;
          word-break: break-word;
        }

        /* TABEL DATA KIRI */
        .ktp-table {
          width: 100%;
          table-layout: fixed;
        }
        .ktp-table td {
          padding: 0.55mm 0;
          vertical-align: top;
          font-size: 8.5px;   /* sedikit dibesarkan biar lebih terbaca */
          line-height: 1.15;
        }
        .ktp-label {
          width: 28mm;
          font-weight: 700;
        }
        .ktp-colon {
          width: 3mm;
          text-align: center;
          font-weight: 700;
        }
        .ktp-value {
          word-break: break-word;
        }
        .ktp-nik {
          font-weight: 800;
          letter-spacing: 0.2px;
        }
        .gap {
          height: 1.2mm;
        }

        /* FOTO */
        .ktp-photo {
          width: 26mm;
          height: 32mm;
          margin: 0 auto;
          overflow: hidden;
          border-radius: 2mm;
          background: #fff;
          border: 0.35mm solid #000; /* foto tetap ada frame tipis */
          box-sizing: border-box;
        }
        .ktp-photo img {
          width: 100%;
          height: 100%;
        }

        /* TTD - BORDER DIHILANGKAN (sesuai permintaan) */
        .sign-title {
          margin-top: 2mm;
          font-size: 7px;
          font-weight: 700;
        }
        .sign-box {
          width: 26mm;
          height: 16mm;
          margin: 1mm auto 0 auto;

          border: none;           /* ini yang menghilangkan border TTD */
          border-radius: 0;
          background: #fff;

          overflow: hidden;
          box-sizing: border-box;
        }
        .sign-box img {
          max-width: 100%;
          max-height: 100%;
          width: auto;
          height: auto;
        }
        .sign-name {
          margin-top: 1mm;
          font-size: 7px;
          font-weight: 700;
          line-height: 1.1;
          white-space: normal;
          word-break: break-word;
        }
      ]]></style>

      <t t-foreach="docs" t-as="o">

        <!-- SAFE VALUE supaya tidak error kalau field belum ada -->
        <t t-set="kabupaten_name"
           t-value="(o._fields.get('kabupaten_id') and o.kabupaten_id and (o.kabupaten_id.name or '')) or (o._fields.get('kabupaten') and (o.kabupaten or '')) or ''"/>

        <t t-set="kabupaten_display"
           t-value="(kabupaten_name and ((kabupaten_name.lower().startswith('kab') or kabupaten_name.lower().startswith('kota')) and kabupaten_name or ('Kabupaten %s' % kabupaten_name))) or ''"/>

        <t t-set="kelurahan_name"
           t-value="(o._fields.get('kelurahan_id') and o.kelurahan_id and (o.kelurahan_id.name or '')) or (o._fields.get('kelurahan') and (o.kelurahan or '')) or ''"/>

        <t t-set="kecamatan_name"
           t-value="(o._fields.get('kecamatan_id') and o.kecamatan_id and (o.kecamatan_id.name or '')) or (o._fields.get('kecamatan') and (o.kecamatan or '')) or ''"/>

        <t t-set="rt_val" t-value="o._fields.get('rt') and (o.rt or '') or ''"/>
        <t t-set="rw_val" t-value="o._fields.get('rw') and (o.rw or '') or ''"/>
        <t t-set="rt_rw"  t-value="(rt_val or rw_val) and ('%s/%s' % (rt_val, rw_val)) or ''"/>

        <t t-set="gol_darah" t-value="o._fields.get('gol_darah') and (o.gol_darah or '') or ''"/>
        <t t-set="agama"     t-value="o._fields.get('agama') and (o.agama or '') or ''"/>

        <t t-set="status_perkawinan"
           t-value="(o._fields.get('status') and (o.status or '')) or (o._fields.get('status_perkawinan') and (o.status_perkawinan or '')) or ''"/>

        <t t-set="pekerjaan"       t-value="o._fields.get('pekerjaan') and (o.pekerjaan or '') or ''"/>
        <t t-set="kewarganegaraan" t-value="o._fields.get('kewarganegaraan') and (o.kewarganegaraan or '') or ''"/>

        <t t-set="ttd_img"
           t-value="(o._fields.get('tanda_tangan') and o.tanda_tangan) or (o._fields.get('signature') and o.signature) or (o._fields.get('ttd') and o.ttd) or False"/>

        <div class="page ektp-page">
          <div class="ktp-card">

            <!-- HEADER -->
            <div class="ktp-header">
              <div class="ktp-title-1">KARTU TANDA PENDUDUK</div>
              <div class="ktp-title-2">REPUBLIK INDONESIA</div>
            </div>

            <!-- BODY -->
            <table class="ktp-body-table">
              <tr>
                <!-- LEFT -->
                <td class="ktp-left">
                  <table class="ktp-table">
                    <tr>
                      <td class="ktp-label">NIK</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value ktp-nik"><t t-esc="o.nik or ''"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Nama</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="o.nama or ''"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Tmp/Tgl Lahir</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value">
                        <t t-esc="o.tempat_lahir or ''"/><t t-if="o.tempat_lahir and o.tanggal_lahir">, </t><t t-esc="o.tanggal_lahir or ''"/>
                      </td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Jenis Kelamin</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><span t-field="o.jenis_kelamin"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Gol. Darah</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="gol_darah"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Alamat</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="o.alamat or ''"/></td>
                    </tr>

                    <tr><td class="gap" colspan="3"></td></tr>

                    <tr>
                      <td class="ktp-label">RT/RW</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="rt_rw"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Kel/Desa</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="kelurahan_name"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Kecamatan</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="kecamatan_name"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Agama</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="agama"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Status</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="status_perkawinan"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Pekerjaan</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="pekerjaan"/></td>
                    </tr>
                    <tr>
                      <td class="ktp-label">Kewarganegaraan</td>
                      <td class="ktp-colon">:</td>
                      <td class="ktp-value"><t t-esc="kewarganegaraan"/></td>
                    </tr>
                  </table>
                </td>

                <!-- RIGHT -->
                <td class="ktp-right">

                  <!-- Kabupaten disejajarkan dengan foto (di atas foto) -->
                  <div class="ktp-region-right" t-if="kabupaten_display">
                    <t t-esc="kabupaten_display"/>
                  </div>

                  <div class="ktp-photo">
                    <img t-if="o.foto" t-att-src="image_data_uri(o.foto)" alt="Foto"/>
                  </div>

                  <div class="sign-title">Tanda Tangan</div>

                  <div class="sign-box">
                    <img t-if="ttd_img" t-att-src="image_data_uri(ttd_img)" alt="Tanda Tangan"/>
                  </div>

                  <div class="sign-name">
                    <t t-esc="o.nama or ''"/>
                  </div>
                </td>
              </tr>
            </table>

          </div>
        </div>

      </t>
    </t>
  </template>

</odoo>